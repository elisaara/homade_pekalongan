let url, persetujuan = $("#persetujuan").DataTable({
    responsive: !0,
    scrollX: !0,
    ajax: readUrl,
    columnDefs: [{
        searcable: !1,
        orderable: !1,
        targets: 0
    },{
        "targets": [1],
        "visible": false,
        "searchable": false
    },{
        "targets": [4],
        "width": "300px"
    },{
        "targets": [7],
        "width": "30px"
    }],
    order: [
        [1, "desc"]
    ],
    columns: [{
        data: null
    }, {
        data: "id"
    }, {
        data: "transaction"
    }, {
        data: "action"
    }, {
        data: "table_data"
    }, {
        data: "requested_by"
    }, {
        data: "requested_date"
    }, {
        data: "approval"
    }]
});

function reloadTable() {
    persetujuan.ajax.reload()
}

function addData() {
    $.ajax({
        url: addUrl,
        type: "post",
        dataType: "json",
        data: $("#form").serialize(),
        success: () => {
            $(".modal").modal("hide"), Swal.fire("Sukses", "Sukses Menambahkan Data", "success"), reloadTable()
        },
        error: a => {
            console.log(a)
        }
    })
}

function update(a, s) {
    $title = s==1 ? 'Approve' : 'Reject';
    Swal.fire({
        title: "Konfirmasi",
        text: $title+" perubahan ini?",
        type: "warning",
        showCancelButton: !0
    }).then((e) => {
        e.value && $.ajax({
            url: editUrl,
            type: "post",
            dataType: "json",
            data: {
                id: a
                , status: s
            },
            success: a => {
                Swal.fire("Sukses", "Sukses "+$title+" Data", "success"), reloadTable()
            },
            error: a => {
                console.log(a)
            }
        })
    }, function(dismiss){
                console.log(dismiss)
    });
}

function editData() {
    $.ajax({
        url: editUrl,
        type: "post",
        dataType: "json",
        data: $("#form").serialize(),
        success: () => {
            $(".modal").modal("hide"), Swal.fire("Sukses", "Sukses Mengedit Data", "success"), reloadTable()
        },
        error: a => {
            console.log(a)
        }
    })
}

function add() {
    url = "add", $(".modal-title").html("Tambah persetujuan"), $('.modal button[type="submit"]').html("Simpan")
}

function edit(a) {
    $.ajax({
        url: get_persetujuanUrl,
        type: "post",
        dataType: "json",
        data: {
            id: a
        },
        success: a => {
            $('[name="id"]').val(a.id), $('[name="nama"]').val(a.nama), $('[name="alamat"]').val(a.alamat), $('[name="telepon"]').val(a.telepon), $('[name="keterangan"]').val(a.keterangan), $(".modal").modal("show"), $(".modal-title").html("Edit persetujuan"), $('.modal button[type="submit"]').html("Simpan"), url = "edit"
        },
        error: a => {
            console.log(a)
        }
    })
}
persetujuan.on("order.dt search.dt", () => {
    persetujuan.column(0, {
        search: "applied",
        order: "applied"
    }).nodes().each((a, e) => {
        a.innerHTML = e + 1
    })
}), $("#form").validate({
    errorElement: "span",
    errorPlacement: (a, e) => {
        a.addClass("invalid-feedback"), e.closest(".form-group").append(a)
    },
    submitHandler: () => {
        "edit" == url ? editData() : addData()
    }
}), $(".modal").on("hidden.bs.modal", () => {
    $("#form")[0].reset(), $("#form").validate().resetForm()
});